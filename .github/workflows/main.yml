name: Telegram Notifications

on:
  pull_request:
    types: [opened, closed, reopened, synchronize]
  push:
    branches:
      - main  # –ï—Å–ª–∏ —É –≤–∞—Å –≥–ª–∞–≤–Ω–∞—è –≤–µ—Ç–∫–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "master", –∑–∞–º–µ–Ω–∏—Ç–µ "main" –Ω–∞ "master"

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Check Event Type and Send Telegram Notification
        run: |
          REPO_NAME="${{ github.repository }}"
          EVENT_TYPE="${{ github.event_name }}"

          if [[ "$EVENT_TYPE" == "pull_request" ]]; then
            PR_TITLE="${{ github.event.pull_request.title }}"
            PR_URL="${{ github.event.pull_request.html_url }}"
            PR_AUTHOR="${{ github.event.pull_request.user.login }}"
            PR_STATE="${{ github.event.action }}" # opened, closed, etc.

            MESSAGE="üõ† Pull Request –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: ${REPO_NAME}
          üîπ –ê–≤—Ç–æ—Ä: ${PR_AUTHOR}
          üîπ –î–µ–π—Å—Ç–≤–∏–µ: ${PR_STATE}
          üîπ –ù–∞–∑–≤–∞–Ω–∏–µ: ${PR_TITLE}
          üîó [–û—Ç–∫—Ä—ã—Ç—å PR](${PR_URL})"

          elif [[ "$EVENT_TYPE" == "push" ]]; then
            COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
            COMMIT_AUTHOR="${{ github.event.head_commit.author.name }}"
            COMMIT_URL="${{ github.event.head_commit.url }}"

            MESSAGE="üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≥–ª–∞–≤–Ω–∞—è –≤–µ—Ç–∫–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: ${REPO_NAME}
          üîπ –ê–≤—Ç–æ—Ä: ${COMMIT_AUTHOR}
          üîπ –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞: ${COMMIT_MESSAGE}
          üîó [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–º–∏—Ç](${COMMIT_URL})"
          fi

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d "text=${MESSAGE}" 
